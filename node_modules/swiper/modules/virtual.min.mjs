import{g as getDocument}from"../shared/ssr-window.esm.min.mjs";import{a as setCSSProperty,e as elementChildren,c as createElement}from"../shared/utils.min.mjs";function Virtual(e){let t,{swiper:s,extendParams:i,on:r,emit:a}=e;i({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const l=getDocument();s.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const d=l.createElement("div");function n(e,t){const i=s.params.virtual;if(i.cache&&s.virtual.cache[t])return s.virtual.cache[t];let r;return i.renderSlide?(r=i.renderSlide.call(s,e,t),"string"==typeof r&&(setInnerHTML(d,r),r=d.children[0])):r=s.isElement?createElement("swiper-slide"):createElement("div",s.params.slideClass),r.setAttribute("data-swiper-slide-index",t),i.renderSlide||setInnerHTML(r,e),i.cache&&(s.virtual.cache[t]=r),r}function c(e,t,i){const{slidesPerView:r,slidesPerGroup:l,centeredSlides:d,loop:c,initialSlide:o}=s.params;if(t&&!c&&o>0)return;const{addSlidesBefore:u,addSlidesAfter:p}=s.params.virtual,{from:h,to:f,slides:v,slidesGrid:m,offset:g}=s.virtual;s.params.cssMode||s.updateActiveIndex();const E=void 0===i?s.activeIndex||0:i;let x,w,S;x=s.rtlTranslate?"right":s.isHorizontal()?"left":"top",d?(w=Math.floor(r/2)+l+p,S=Math.floor(r/2)+l+u):(w=r+(l-1)+p,S=(c?r:l)+u);let b=E-S,A=E+w;c||(b=Math.max(b,0),A=Math.min(A,v.length-1));let M=(s.slidesGrid[b]||0)-(s.slidesGrid[0]||0);function y(){s.updateSlides(),s.updateProgress(),s.updateSlidesClasses(),a("virtualUpdate")}if(c&&E>=S?(b-=S,d||(M+=s.slidesGrid[0])):c&&E<S&&(b=-S,d&&(M+=s.slidesGrid[0])),Object.assign(s.virtual,{from:b,to:A,offset:M,slidesGrid:s.slidesGrid,slidesBefore:S,slidesAfter:w}),h===b&&f===A&&!e)return s.slidesGrid!==m&&M!==g&&s.slides.forEach((e=>{e.style[x]=M-Math.abs(s.cssOverflowAdjustment())+"px"})),s.updateProgress(),void a("virtualUpdate");if(s.params.virtual.renderExternal)return s.params.virtual.renderExternal.call(s,{offset:M,from:b,to:A,slides:function(){const e=[];for(let t=b;t<=A;t+=1)e.push(v[t]);return e}()}),void(s.params.virtual.renderExternalUpdate?y():a("virtualUpdate"));const P=[],j=[],C=e=>{let t=e;return e<0?t=v.length+e:t>=v.length&&(t-=v.length),t};if(e)s.slides.filter((e=>e.matches(`.${s.params.slideClass}, swiper-slide`))).forEach((e=>{e.remove()}));else for(let e=h;e<=f;e+=1)if(e<b||e>A){const t=C(e);s.slides.filter((e=>e.matches(`.${s.params.slideClass}[data-swiper-slide-index="${t}"], swiper-slide[data-swiper-slide-index="${t}"]`))).forEach((e=>{e.remove()}))}const G=c?-v.length:0,I=c?2*v.length:v.length;for(let t=G;t<I;t+=1)if(t>=b&&t<=A){const s=C(t);void 0===f||e?j.push(s):(t>f&&j.push(s),t<h&&P.push(s))}if(j.forEach((e=>{s.slidesEl.append(n(v[e],e))})),c)for(let e=P.length-1;e>=0;e-=1){const t=P[e];s.slidesEl.prepend(n(v[t],t))}else P.sort(((e,t)=>t-e)),P.forEach((e=>{s.slidesEl.prepend(n(v[e],e))}));elementChildren(s.slidesEl,".swiper-slide, swiper-slide").forEach((e=>{e.style[x]=M-Math.abs(s.cssOverflowAdjustment())+"px"})),y()}r("beforeInit",(()=>{if(!s.params.virtual.enabled)return;let e;if(void 0===s.passedParams.virtual.slides){const t=[...s.slidesEl.children].filter((e=>e.matches(`.${s.params.slideClass}, swiper-slide`)));t&&t.length&&(s.virtual.slides=[...t],e=!0,t.forEach(((e,t)=>{e.setAttribute("data-swiper-slide-index",t),s.virtual.cache[t]=e,e.remove()})))}e||(s.virtual.slides=s.params.virtual.slides),s.classNames.push(`${s.params.containerModifierClass}virtual`),s.params.watchSlidesProgress=!0,s.originalParams.watchSlidesProgress=!0,c(!1,!0)})),r("setTranslate",(()=>{s.params.virtual.enabled&&(s.params.cssMode&&!s._immediateVirtual?(clearTimeout(t),t=setTimeout((()=>{c()}),100)):c())})),r("init update resize",(()=>{s.params.virtual.enabled&&s.params.cssMode&&setCSSProperty(s.wrapperEl,"--swiper-virtual-size",`${s.virtualSize}px`)})),Object.assign(s.virtual,{appendSlide:function(e){if("object"==typeof e&&"length"in e)for(let t=0;t<e.length;t+=1)e[t]&&s.virtual.slides.push(e[t]);else s.virtual.slides.push(e);c(!0)},prependSlide:function(e){const t=s.activeIndex;let i=t+1,r=1;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1)e[t]&&s.virtual.slides.unshift(e[t]);i=t+e.length,r=e.length}else s.virtual.slides.unshift(e);if(s.params.virtual.cache){const e=s.virtual.cache,t={};Object.keys(e).forEach((s=>{const i=e[s],a=i.getAttribute("data-swiper-slide-index");a&&i.setAttribute("data-swiper-slide-index",parseInt(a,10)+r),t[parseInt(s,10)+r]=i})),s.virtual.cache=t}c(!0),s.slideTo(i,0)},removeSlide:function(e){if(null==e)return;let t=s.activeIndex;if(Array.isArray(e))for(let i=e.length-1;i>=0;i-=1)s.params.virtual.cache&&(delete s.virtual.cache[e[i]],Object.keys(s.virtual.cache).forEach((t=>{t>e&&(s.virtual.cache[t-1]=s.virtual.cache[t],s.virtual.cache[t-1].setAttribute("data-swiper-slide-index",t-1),delete s.virtual.cache[t])}))),s.virtual.slides.splice(e[i],1),e[i]<t&&(t-=1),t=Math.max(t,0);else s.params.virtual.cache&&(delete s.virtual.cache[e],Object.keys(s.virtual.cache).forEach((t=>{t>e&&(s.virtual.cache[t-1]=s.virtual.cache[t],s.virtual.cache[t-1].setAttribute("data-swiper-slide-index",t-1),delete s.virtual.cache[t])}))),s.virtual.slides.splice(e,1),e<t&&(t-=1),t=Math.max(t,0);c(!0),s.slideTo(t,0)},removeAllSlides:function(){s.virtual.slides=[],s.params.virtual.cache&&(s.virtual.cache={}),c(!0),s.slideTo(0,0)},update:c})}export{Virtual as default};
//# sourceMappingURL=virtual.min.mjs.map